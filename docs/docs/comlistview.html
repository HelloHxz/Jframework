<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
        <link href="./css/doccommon.css" rel="stylesheet"/>
    </head>
    <body>
        <div class='doc-dabiaoti'>列表<span class='doc-subdabiaoti'>ListView</span></div>
        <div class='doc-zhengwen'>
            该组件提供强大的列表展示功能
        </div>
        <ul class='doc-ul'><li>
            通过和<span class='doc-order'>View</span>组件的配置,实现下拉刷新上拉加载更多的功能
        </li>
        <li>
           提供行侧滑操作功能,比如行侧滑进行删除
        </li>
        <li>
           提供行多选,行单选功能
        </li>
        <li>
           提供各种数据加载,数据更新,行操作的API
        </li>
    </ul>

    <div class='doc-miaoshu'>ListView组件是ListRow组件的集合</div>
    <div class='doc-fubiaoti'>UI配置选项</div>
    <ul class='doc-pros-ul'>
            <li>
                <div class='doc-pros-top'>type<span class='doc-pros-type'>string</span></div>
                <div class='doc-pros-desc'>制定组件的类型为<span class='doc-order'>listview</span></div>
            </li>
            <li>
                <div class='doc-pros-top'>root<span  class='doc-pros-type'>array</span></div>
                <div class='doc-pros-desc'>行第一级子组件的Key的集合,用于描述行的字组件的组成</div>
            </li>
            <li>
                <div class='doc-pros-top'>style<span  class='doc-pros-type'>json</span></div>
                <div class='doc-pros-desc'>列表整体的样式配置</div>
            </li>
              <li>
                <div class='doc-pros-top'>rowStyle<span  class='doc-pros-type'>json</span></div>
                <div class='doc-pros-desc'>行的样式配置,比如可以指定行的排列方向</div>
            </li>

             <li>
                <div class='doc-pros-top'>ajaxConfig<span  class='doc-pros-type'>json</span></div>
                <div class='doc-pros-desc'>列表的Ajax的配置</div>
                <pre><code class='json'>
ajaxConfig:{
    url:"/getlistdata",
    firstPageIndex:0,//下标开始是从0或者1
    type:"GET",
    pageSize:20,
    pageNumKey:"pagenum",
    data:{
     pagesizevalue:20
    }
},
                </code></pre>
            </li>
              <li>
                <div class='doc-pros-top'>nodata<span  class='doc-pros-type'>string</span></div>
                <div class='doc-pros-desc'>制定列表在没有数据的时候展示的组件Key</div>
            </li>
             <li>
                <div class='doc-pros-top'>rowSwipeIcons<span  class='doc-pros-type'>Array</span></div>
                <div class='doc-pros-desc'>制定行侧滑的组件Key数组</div>
            </li>
             <li>
                <div class='doc-pros-top'>selectedMode<span class='doc-pros-type'>string</span></div>
                <div class='doc-pros-desc'>行的选择模式,选值: s 表示单选, m 表示多选</div>
            </li>
             <li>
                <div class='doc-pros-top'>groupKey<span class='doc-pros-type'>string</span></div>
                <div class='doc-pros-desc'>通过制定数据源中的字段来进行列表分组显示</div>
            </li>
     </ul>
    <div class='doc-fubiaoti'>ListView 属性</div>
     <ul class='doc-pros-ul'>
            <li>
                <div class='doc-pros-top'>getRowCount()<span class='doc-pros-type'>function</span></div>
                <div class='doc-pros-desc'>获取列表的行数</div>
            </li>
            <li>
                <div class='doc-pros-top'>eachRow(callback)<span class='doc-pros-type'>function</span></div>
                <div class='doc-pros-desc'>遍历所有的行,通过callback可以操作行的实例对象</div>
            </li>
            <li>
                <div class='doc-pros-top'>empty()<span class='doc-pros-type'>function</span></div>
                <div class='doc-pros-desc'>清空所有行</div>
            </li>
            <li>
                <div class='doc-pros-top'>loadFirstPageData()<span class='doc-pros-type'>function</span></div>
                <div class='doc-pros-desc'>加载第一页的数据</div>
            </li>
            <li>
                <div class='doc-pros-top'>loadNextPageData()<span class='doc-pros-type'>function</span></div>
                <div class='doc-pros-desc'>加载下一页的数据</div>
            </li>
             <li>
                <div class='doc-pros-top'>setAjaxConfigParams(params)<span class='doc-pros-type'>function</span></div>
                <div class='doc-pros-desc'>设置Ajax参数,比如在程序逻辑中需要动态修改请求参数的话调用该方法。</div>
            </li>
             <li>
                <div class='doc-pros-top'>insertRow(rowdata,index)<span class='doc-pros-type'>function</span></div>
                <div class='doc-pros-desc'>制定行的下标插入一行</div>
            </li>
             <li>
                <div class='doc-pros-top'>xxkey_init(sender,params)<span class='doc-pros-type'>Event</span></div>
                <div class='doc-pros-desc'>组件初始化</div>
            </li>
             <li>
                <div class='doc-pros-top'>xxkey_beforeload(sender,params)<span class='doc-pros-type'>Event</span></div>
                <div class='doc-pros-desc'>发起请求之前的事件处理时机,可以对网络请求参数进行修改</div>
            </li>
            <li>
                <div class='doc-pros-top'>xxkey_parsedata(sender,params)<span class='doc-pros-type'>Event</span></div>
                <div class='doc-pros-desc'>请求数据的返回进行数据转换时机,因为不同接口后台返回的数据格式不一样,</br>
                    ListView组件绑定的需要是一个数据数组,在这个方法中可以将数据挑选出来然后return返回给组件,同样在这个方法中可以对数据进行预处理,</br>如果数据格式错误或者网络错误的话直接返回false即可</div>
            </li>
             <li>
                <div class='doc-pros-top'>xxkey_afterload(sender,params)<span class='doc-pros-type'>Event</span></div>
                <div class='doc-pros-desc'>请求完成出发的时机</div>
            </li>

            <li>
               <div class='doc-pros-top'>xxkey_getrowswipeicons(sender,params)<span class='doc-pros-type'>Event</span></div>
               <div class='doc-pros-desc'>动态配置行侧滑按钮事件</div>
           </li>

    </ul>
    <div class='doc-fubiaoti'>ListRow 属性</div>
    <ul class='doc-pros-ul'>
            <li>
                <div class='doc-pros-top'>rebind(rowdata)<span class='doc-pros-type'>function</span></div>
                <div class='doc-pros-desc'>行重新绑定数据</div>
            </li>
              <li>
                <div class='doc-pros-top'>delete(isNoAnimated)<span class='doc-pros-type'>function</span></div>
                <div class='doc-pros-desc'>删除行,isNoAnimated为true 无动画，isNoAnimated为false 有动画效果,默认为false</div>
            </li>
             <li>
                <div class='doc-pros-top'>select()<span class='doc-pros-type'>function</span></div>
                <div class='doc-pros-desc'>行选择方法,行如果选中的话则被取消选中,未被选中的话则被选中</div>
            </li>
    </ul>
    <div class='doc-fubiaoti'>接口约定</div>
    <div class='doc-area'>本组件提供上拉加载更多的功能,要实现该功能需要后台接口的配合。定义服务API的话必须提供
        <ul class='doc-ul'>
            <li>页码  比如Demo例子中取名为：<span class='doc-order'>pageNum</span></li>
            <li>一页获取的条数 比如Demo例子中取名为：<span class='doc-order'>pageSize</span></li>
        </ul>
    </div>
    <div class='doc-miaoshu'>
        本实例使用的接口是Node提供的简单服务接口,可以查看框架目录下的
        <span class='doc-order'>server.js</span>,所以在项目目录下的<span class='doc-order'>app.js</span>的<span class='doc-order'>host</span>配置是
        <span class='doc-order'>http://localhost:3333/</span><span onClick="gotoVariable()" class='doc-link'>详细</span>
    </div>
    <div class='doc-fubiaoti'>Demo接口介绍</div>
    <div class="doc-xiaobiaoti">地址</div>
    <div class='doc-miaoshu'>
        http://localhost:3333/getlistdata
    </div>
    <div class="doc-xiaobiaoti">参数</div>
    <ul class='doc-ul'>
        <li>pageSize 一页的记录条数</li>
        <li>pageNum 页码</li>
    </ul>
    <div class="doc-xiaobiaoti">返回结果</div>
    <pre><code class='json'>
//成功
{
    code:0,
    msg:"描述信息",
    data:[...]
}
//失败
{
    code:-1000,
    msg:"失败"
}
    </code></pre>
    <div class='doc-miaoshu doc-important'>每个接口返回值都不尽相同,所以需要在listview的_parsedata事件中把正确的数组return给列表,列表才知道如何展示</div>
    <div class='doc-fubiaoti'>例子(一) 简单的ListView</div>
    <div class='doc-xiaobiaoti'>1.1 页面布局</div>
    <div class='doc-area'>
        首先使用两个View组件组成简单的两行上下布局,分别名为<span class='doc-order'>page_header</span><span class='doc-order'>page_content</span>
    </br>
        使用<span class='doc-order'>page_content</span> View 组件包含ListView并让其配合ListView完成下拉刷新上拉加载更多的功能
    </div>
<pre style="margin-top:10px"><code class='javascript'>
    define(["../logic/simplelistview"],function(pluginClass){
        return {
            pluginClass:pluginClass,
            style:{
                backgroundColor:"#f0f4f6"
            },
            root:["page_header","page_content"],
            components:{
                page_header:{
                    type:"view",
                    root:["backIcon","header_title"],
                    style:{
                        height:"44px",
                        borderBottom:"1px solid #e2e8ed",
                        backgroundColor:"#fff",
                        justifyContent:"center",
                        alignItems:"center"
                    }
                },
                header_title:{
                    type:"text",
                    text:"简单ListView",
                    style:{
                      fontSize:14
                    }
                },
                backIcon:{
                  type:"icon",
                  text:"返回",
                  style:{
                    position: "absolute",
                    left: "0px",
                    color: "rgb(0, 147, 255)",
                    top: "7px",
                    width: "50px",
                    height: "30px",
                  },
                  textStyle: {
                    fontSize: "14px"
                  }
                },
                page_content:{
                    type:"view",
                    root:["listview"],
                    style:{
                      flex:1,
                      overflowY:"auto",
                      backgroundColor:"#fff"
                    }
                },
                listview:{
                  type:"listview",
                  root:["row_name"],
                  ajaxConfig:{
                      url:"/getlistdata",
                      type:"GET",
                      pageSize:20,
                      pageNumKey:"pageNum",
                      data:{
                        pageSize:20
                    },
                  },
                  style:{
                    flexDirection:'column',
                    paddingLeft:8,
                  },
                  rowStyle:{
                    paddingTop:15,
                    paddingBottom:15,
                    borderBottom:"1px solid #eee",
                    flexDirection:'column'
                  },
                },

                row_name:{
                    type:"text",
                    style:{
                        fontSize:13,
                        color:"#333"
                    },
                    text_bind:"name"
                }
            }
        };
    });
</code></pre>
<div class='doc-xiaobiaoti'>2.1 逻辑关联</div>

    <pre><code class='javascript'>
define([],function(){
    function pageLogic(config){
      this.pageview = config.pageview;
    }
    pageLogic.prototype = {
        backIcon_click:function(){
            this.pageview.goBack();
        },

        //page_content 组件声明事件 让该组件具备下拉刷新的功能
        page_content_pulltorefresh:function(sender,params){
            //刷新的时候执行加载第一页的数据
            this.listview.loadFirstPageData();
        },
        //page_content 组件声明事件 让该组件具备上拉加载更多的功能
        page_content_loadmore:function(sender,params){
            //上拉
            this.listview.loadNextPageData();
        },
        page_content_reload:function(sender){
          //当网络失败的时候 显示错误信息  提供再次加载的时机
          //重新调用列表重新加载方法
          this.listview.reload();
        },
        //列表初始化 保留列表对象的引用
        listview_init:function(sender){
            this.listview = sender;
        },
        //列表实例话完成后 调用开始加载数据
        listview_didmount:function(sender){
            sender.loadFirstPageData();
        },
        //列表返回数据的时候 如果获取成功则返回数据中的数组
        //失败的时候则直接return false;界面会显示重新加载的界面
        listview_parsedata:function(sender,params){
            var result = params.data;
            if(result.code!==0){
                return false;
            }
            return result.data;
        },

    };
    return pageLogic;
});

    </code></pre>

    <div class='doc-fubiaoti'>例子(二)  行侧滑和行的基本操作</div>
    <div class='doc-miaoshu doc-important'>关于手势触摸的例子请扫描二维码手机进行体验</div>
    <div class='doc-zhengwen'>继续在之前例子进行改造</div>
    <div class='doc-xiaobiaoti'>2.1 UI文件中增加一个侧滑的Icon声明</div>
    <pre><code class='json'>
rowDelIcon:{
  type:"icon",
  text:"删除",
  font:"icomoon_e903",
  textPos:"bottom",
  iconStyle:{
    fontSize:13,color:"#fff"
  },
  textStyle:{color:"#fff",fontSize:12,marginTop:5},
  style:{
    width:80,
    backgroundColor:"red",
  }
}
        </pre></code>
    <div class='doc-xiaobiaoti'>2.2 listview增加一个属性<span class='doc-order'>rowSwipeIcons:["rowDelIcon"]</span></div>
    <div class='doc-xiaobiaoti'>2.3 逻辑文件中增加该删除按钮的逻辑</div>
    <pre><code class='javascript'>
rowDelIcon_click:function(sender,params){
    //得到当前行的行对象ListRow实例
    var rowInstance = sender.rowInstance;
    //调用ListRow的实例方法
    rowInstance.delete();
}
    </pre></code>
    <div class='doc-xiaobiaoti'>2.4 有时候侧滑的操作每行都不样,需要根据数据的权限或者类型显示不同的侧滑按钮,需要使用到
        <span class='doc-order'>getrowswipeicons事件</span>重复2.1的步骤新增如下按钮</div>
    <pre style='margin-top:20px'><code class='json'>
rowEditIcon:{
  type:"icon",
  text:"编辑",
  textStyle:{color:"#fff",fontSize:12},
  style:{
    width:80,
    backgroundColor:"green",
  }
},rowRebindIcon:{
  type:"icon",
  text:"重新绑定该行",
  textStyle:{color:"#fff",fontSize:12},
  style:{
    width:80,
    backgroundColor:"orange",
  }
},
        </pre></code>
        <div class='doc-xiaobiaoti'>2.5 添加如下逻辑代码</div>
        <pre><code class='javascript'>
listview_getrowswipeicons:function(sender,params){
    //获取到当前行的数据
  var rowDataSource = sender.datasource;
  // or  sender.rowInstance.datasource
  //简单根据数据显示不同的按钮
  if(rowDataSource.status===0){
    return ["rowEditIcon","rowDelIcon"];
  }else if(rowDataSource.status==1){
    return ["rowOtherIcon"];
  }else{
    return ["rowEditIcon","rowOtherIcon"];
  }
},
rowOtherIcon_click:function(sender,params){
    var rowInstance = sender.rowInstance;
    this.pageview.showTip({text:"做其他的操作",duration:900});
    rowInstance.closeSwipe();
},
rowEditIcon_click:function(sender,params){
    //获取到行实例
    var rowInstance = sender.rowInstance;
    //获取到行数据
    var rowDataSource = sender.datasource;
    //修改行数据
    rowDataSource.name = "修改之后的名称";
    //重新绑定行数据
    rowInstance.rebind(rowDataSource);
    //关闭行侧滑
    rowInstance.closeSwipe();
    this.pageview.showTip({text:"修改成功",duration:900});
}
        </code></pre>
    <div class='doc-fubiaoti'>例子(三) 多选和单选ListView</div>
    <div class='doc-xiaobiaoti'>3.1 给listview增加一个属性<span class='doc-order'>selectedMode</div></div>
    <div class='doc-miaoshu'>多选值为 <span class='doc-order'>m </span>  单选值为 <span class='doc-order'>s</span></div></div>
    <div class='doc-xiaobiaoti'>3.2 在行点击事件中进行行对象的select方法调用</div>
    <pre><code class='javascript'>
        listview_rowclick:function(sender){
            //行如果选中 则会被取消选中  行未被选中的话 会被选中
            sender.select();
            //更新文字统计
            this.pageview.delegate("header_right_text",function(target){
                target.setText(sender.parent.selectedRows.length);
            });
        }
    </code></pre>
    <div class='doc-xiaobiaoti'>3.3 到了这步骤已经做到了行的选择功能,但是没有在UI上没有体现</div>
    <div class='doc-miaoshu'>
        通过设置列表中的子元素的<span class='doc-order'>selectedClassName</span>属性,指定该组件的被选择的样式,
        样式的添加方式,参考<span class='doc-link' onClick='goToStyle()'>详细.</span>
    </div>
    <div class='doc-zhengwen'>比如该例子中就是给一个ICON添加选择的样式更换成另外一个ICON,做到了被选中的效果。具体请参照源码</div>
    <pre><code class='css'>
.list-checkicon-selected .yy-icon-code:before{
    content: "\f058";
}
    </code></pre>
    </body>
       <script src="./libs/highlight.pack.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
        function gotoVariable(){
            window.parent.Go("variable");
        }
        function goToStyle(){
            window.parent.Go("style");
        }
    </script>
</html>
